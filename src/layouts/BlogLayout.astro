---
import Layout from '../layouts/Layout.astro';
import ReadingTime from '../components/ReadingTime.astro';
import TableOfContents from '../components/TableOfContents.astro';
import Tags from '../components/Tags.astro';
import RelatedPosts from '../components/RelatedPosts.astro';
import GiscusComments from '../components/GiscusComments.astro';

export interface Props {
  title: string;
  description: string;
  pubDate: Date | string;
  author?: string;
  image?: string;
  tags?: string[];
  rawContent?: string;
  slug?: string;
}

const { 
  title, 
  description, 
  pubDate, 
  author = 'kanr', 
  image, 
  tags = [],
  rawContent = '',
  slug = ''
} = Astro.props;
const date = new Date(pubDate);
const formattedDate = date.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});

const articleJsonLd = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": title,
  "description": description,
  "datePublished": date.toISOString(),
  "author": {
    "@type": "Person",
    "name": author,
    "url": "https://kanr.github.io"
  },
  "url": `https://kanr.github.io/blog/${slug}/`,
  ...(image && { "image": `https://kanr.github.io${image}` }),
  "publisher": {
    "@type": "Person",
    "name": "kanr",
    "url": "https://kanr.github.io"
  },
  ...(tags.length > 0 && { "keywords": tags.join(', ') }),
};
---

<Layout
  title={title}
  description={description}
  image={image}
  type="article"
  publishedTime={date.toISOString()}
  author={author}
>
  <script slot="head" type="application/ld+json" set:html={JSON.stringify(articleJsonLd)} />
  <article class="blog-post">
    <header class="post-header">
      <a href="/blog" class="back-link">&larr; Back to Blog</a>
      {image && <img src={image} alt={title} class="post-image" />}
      <h1>{title}</h1>
      <div class="post-meta">
        <span class="author">By {author}</span>
        <span class="date">{formattedDate}</span>
        {rawContent && <ReadingTime content={rawContent} />}
      </div>
      {tags.length > 0 && (
        <Tags tags={tags} />
      )}
    </header>
    
    {rawContent && (
      <TableOfContents content={rawContent} />
    )}
    
    <main class="post-content">
      <slot />
    </main>
    
    {tags.length > 0 && slug && (
      <RelatedPosts currentSlug={slug} currentTags={tags} />
    )}
    
    <!-- Giscus comments - configure with your repo details -->
    <!-- Uncomment and add your repo details from https://giscus.app -->
    <!--
    <GiscusComments 
      repo="kanr/kanr.github.io" 
      repoId="YOUR_REPO_ID"
      category="Announcements"
      categoryId="YOUR_CATEGORY_ID"
    />
    -->
  </article>
</Layout>

<style>
  .blog-post {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem 1rem;
  }

  .back-link {
    display: inline-block;
    color: rgb(var(--accent));
    text-decoration: none;
    font-size: 0.95rem;
    margin-bottom: 1.5rem;
  }

  .back-link:hover {
    text-decoration: underline;
  }

  .post-header {
    margin-bottom: 2rem;
  }

  .post-image {
    width: 100%;
    height: auto;
    border-radius: 8px;
    margin-bottom: 2rem;
    object-fit: cover;
  }

  h1 {
    font-size: 2.5rem;
    margin-bottom: 1rem;
    color: var(--text-primary);
  }

  .post-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    color: var(--text-secondary);
    font-size: 0.95rem;
    margin-bottom: 1rem;
  }

  .author::before {
    content: '‚úçÔ∏è ';
  }

  .date::before {
    content: 'üìÖ ';
  }

  .post-content {
    line-height: 1.8;
    font-size: 1.05rem;
  }

  :global(.post-content h2) {
    font-size: 1.8rem;
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    color: rgb(var(--accent));
    scroll-margin-top: 80px;
  }

  :global(.post-content h3) {
    font-size: 1.4rem;
    margin-top: 2rem;
    margin-bottom: 0.8rem;
    scroll-margin-top: 80px;
  }

  :global(.post-content p) {
    margin-bottom: 1rem;
    color: var(--text-primary);
  }

  :global(.post-content code) {
    background: var(--bg-secondary);
    padding: 0.2rem 0.4rem;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    font-size: 0.9em;
  }

  :global(.post-content pre) {
    background: var(--bg-secondary);
    padding: 1rem;
    border-radius: 8px;
    overflow-x: auto;
    margin-bottom: 1rem;
    border: 1px solid var(--border-color);
  }

  :global(.post-content pre code) {
    background: none;
    padding: 0;
  }

  :global(.post-content ul),
  :global(.post-content ol) {
    margin-left: 1.5rem;
    margin-bottom: 1rem;
  }

  :global(.post-content li) {
    margin-bottom: 0.5rem;
    color: var(--text-primary);
  }

  :global(.post-content blockquote) {
    border-left: 4px solid rgb(var(--accent));
    padding-left: 1rem;
    margin-left: 0;
    margin-bottom: 1rem;
    font-style: italic;
    color: var(--text-secondary);
  }

  :global(.post-content a) {
    color: rgb(var(--accent));
    text-decoration: none;
  }

  :global(.post-content a:hover) {
    text-decoration: underline;
  }

  :global(.post-content img) {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    margin: 1.5rem 0;
  }

  @media (max-width: 640px) {
    h1 {
      font-size: 2rem;
    }

    :global(.post-content h2) {
      font-size: 1.5rem;
    }

    :global(.post-content h3) {
      font-size: 1.2rem;
    }
  }
</style>
