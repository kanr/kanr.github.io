---
export interface Props {
  repo: string;
  repoId: string;
  category: string;
  categoryId: string;
}

const { repo, repoId, category, categoryId } = Astro.props;
---

<div class="giscus-container">
  <div id="giscus-wrapper">
    <script
      src="https://giscus.app/client.js"
      data-repo={repo}
      data-repo-id={repoId}
      data-category={category}
      data-category-id={categoryId}
      data-mapping="pathname"
      data-strict="0"
      data-reactions-enabled="1"
      data-emit-metadata="0"
      data-input-position="bottom"
      data-theme="preferred_color_scheme"
      data-lang="en"
      crossorigin="anonymous"
      async
    ></script>
  </div>
</div>

<script>
  // Update giscus theme when dark mode changes
  const updateGiscusTheme = (isDark: boolean) => {
    const iframe = document.querySelector<HTMLIFrameElement>('iframe.giscus-frame');
    if (iframe) {
      iframe.contentWindow?.postMessage(
        { giscus: { setConfig: { theme: isDark ? 'dark' : 'light' } } },
        'https://giscus.app'
      );
    }
  };

  // Watch for theme changes
  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (mutation.attributeName === 'data-theme') {
        const theme = document.documentElement.getAttribute('data-theme');
        updateGiscusTheme(theme === 'dark');
      }
    });
  });

  observer.observe(document.documentElement, { attributes: true });
</script>

<style>
  .giscus-container {
    margin-top: 3rem;
    padding-top: 2rem;
    border-top: 1px solid var(--border-color);
  }

  #giscus-wrapper {
    min-height: 200px;
  }
</style>
